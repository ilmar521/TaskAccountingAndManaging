<!DOCTYPE html>
<html>
<head>
  <title>Task Report</title>

  
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css" />
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
   
   <style>
* {
  font-family: 'Kanit', sans-serif;
  box-sizing: border-box;
}

body {
    height: 100vh;
}

:root {
  --background-color: rgb(243, 222, 215);
}

#error-message {
  display: none;
}

.project-row, .user-row {
  font-weight: bold;
  background-color: #f5f5f5;
}

.table-header {
  background-color: #f5f5f5;
}

.level-2 td:first-child {
  padding-left: 40px;
}
.level-1 td:first-child {
  padding-left: 20px;
}

.toggle-icon {
  cursor: pointer;
  user-select: none;
}

.hidden {
  display: none;
}

.dropdown-menu {
  background-color: var(--background-color);
}

.dropdown-item {
  color: black;
}

.dropdown-item:hover,
.dropdown-item:focus {
  background-color: var(--background-color);
  color: black;
  text-decoration: underline;
}

.form-check-input:checked {
  background-color: #dc3545;
  border-color: #dc3545;
}
 </style>   

</head>
<body>

  
  <div class="table-responsive">
    <table class="table" class="table table-striped table-bordered">
      <colgroup>
        <col style="width: 55%;">
        <col style="width: 15%;">
        <col style="width: 15%;">
        <col style="width: 15%;">
      </colgroup>
      <thead>
        <tr class="table-header">
          <th>User<br>Project<br>Task</th>
          <th>Hours</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr class="user-row collapsed">
            <td>
              <span class="toggle-icon" onclick="toggleUser.call(this)">+</span> User 1
            </td>
            <td>{{ project['total_hours'] }}</td>
            <td>{{ project['hour_rate'] }}</td>
            <td>{{ project['total_amount'] }}</td>
        </tr>
          <tr class="project-row level-1 collapsed hidden">
              <td>
                <span class="toggle-icon" onclick="toggleProject.call(this)">+</span> {{ project['name'] }}
              </td>
              <td>{{ project['total_hours'] }}</td>
              <td>{{ project['hour_rate'] }}</td>
              <td>{{ project['total_amount'] }}</td>
          </tr>
              <tr class="task-row level-2 hidden">
                <td> {{ task['details'] }} </td>
                <td> {{ task['hours'] }} </td>
                <td> {{ project['hour_rate'] }} </td>
                <td> {{ task['total_amount'] }} </td>
              </tr>
              <tr class="task-row level-2 hidden">
                <td> {{ task['details'] }} </td>
                <td> {{ task['hours'] }} </td>
                <td> {{ project['hour_rate'] }} </td>
                <td> {{ task['total_amount'] }} </td>
              </tr>
              <tr class="task-row level-2 hidden">
                <td> {{ task['details'] }} </td>
                <td> {{ task['hours'] }} </td>
                <td> {{ project['hour_rate'] }} </td>
                <td> {{ task['total_amount'] }} </td>
              </tr>
            <tr class="user-row collapsed">
                <td>
                  <span class="toggle-icon" onclick="toggleUser.call(this)">+</span> User 2
                </td>
                <td>{{ project['total_hours'] }}</td>
                <td>{{ project['hour_rate'] }}</td>
                <td>{{ project['total_amount'] }}</td>
            </tr>
              <tr class="project-row level-1 collapsed hidden">
                  <td>
                    <span class="toggle-icon" onclick="toggleProject.call(this)">+</span> {{ project['name'] }}
                  </td>
                  <td>{{ project['total_hours'] }}</td>
                  <td>{{ project['hour_rate'] }}</td>
                  <td>{{ project['total_amount'] }}</td>
              </tr>
                  <tr class="task-row level-2 hidden">
                    <td> {{ task['details'] }} </td>
                    <td> {{ task['hours'] }} </td>
                    <td> {{ project['hour_rate'] }} </td>
                    <td> {{ task['total_amount'] }} </td>
                  </tr>
                  <tr class="task-row level-2 hidden">
                    <td> {{ task['details'] }} </td>
                    <td> {{ task['hours'] }} </td>
                    <td> {{ project['hour_rate'] }} </td>
                    <td> {{ task['total_amount'] }} </td>
                  </tr>
                  <tr class="task-row level-2 hidden">
                    <td> {{ task['details'] }} </td>
                    <td> {{ task['hours'] }} </td>
                    <td> {{ project['hour_rate'] }} </td>
                    <td> {{ task['total_amount'] }} </td>
                  </tr>

      </tbody>
    </table>

<script>

function toggleProject() {
  var projectRow = this.parentNode.parentNode;
  var nextRow = projectRow.nextElementSibling;

  while (nextRow && !nextRow.classList.contains('project-row')) {
    if (nextRow.classList.contains('task-row')) {
      if (nextRow.classList.contains('hidden')) {
        nextRow.classList.remove('hidden');
      } else {
        nextRow.classList.add('hidden');
      }
    }
    nextRow = nextRow.nextElementSibling;
  }

  if (projectRow.classList.contains('collapsed')) {
    projectRow.classList.remove('collapsed');
    this.textContent = '-';
  } else {
    projectRow.classList.add('collapsed');
    this.textContent = '+';
  }
}

function toggleUser() {
  var userRow = this.parentNode.parentNode;
  var nextRow = userRow.nextElementSibling;

  while (nextRow && !nextRow.classList.contains('user-row')) {
    if (nextRow.classList.contains('project-row')) {
      if (nextRow.classList.contains('hidden')) {
        nextRow.classList.remove('hidden');
      } else {
        nextRow.classList.add('hidden');
      }

      var nextRowTask = nextRow.nextElementSibling;
      while (nextRowTask && !nextRowTask.classList.contains('project-row') && !nextRowTask.classList.contains('user-row')) {
        if (nextRowTask.classList.contains('task-row')) {
          if (nextRow.classList.contains('hidden')) {
            nextRowTask.classList.add('hidden');
          } else {
            if (nextRow.classList.contains('collapsed')) {
              nextRowTask.classList.add('hidden'); 
            } else { 
              nextRowTask.classList.remove('hidden');   
            }         
          }  
        }
        nextRowTask = nextRowTask.nextElementSibling;     
      }
    }
    nextRow = nextRow.nextElementSibling;
  }

  if (userRow.classList.contains('collapsed')) {
    userRow.classList.remove('collapsed');
    this.textContent = '-';
  } else {
    userRow.classList.add('collapsed');
    this.textContent = '+';
  }
}

</script>

</body>
</html>